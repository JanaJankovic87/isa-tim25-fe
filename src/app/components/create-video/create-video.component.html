<div class="page">
  
  <div class="top-actions">
    <button class="back-btn" (click)="onCancel()">
      <svg width="20" height="20" viewBox="0 0 24 24">
        <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      Back
    </button>
  </div>
  
  <div class="container">
    
    <div class="header">
      <h1>Upload Video</h1>
    </div>
    <div *ngIf="errorMessage" class="error-box">{{ errorMessage }}</div>
    <form [formGroup]="videoForm" (ngSubmit)="onSubmit()">
      
      <div class="field">
        <label>Title *</label>
        <input type="text" formControlName="title" placeholder="Enter video title">
        <div *ngIf="videoForm.get('title')?.touched && videoForm.get('title')?.invalid" style="color: #ff4444; font-size: 12px; margin-top: 4px;">
          Title is required (minimum 3 characters)
        </div>
      </div>
      <div class="field">
        <label>Description *</label>
        <textarea formControlName="description" rows="4" placeholder="Enter video description"></textarea>
        <div *ngIf="videoForm.get('description')?.touched && videoForm.get('description')?.invalid" style="color: #ff4444; font-size: 12px; margin-top: 4px;">
          Description is required (minimum 10 characters)
        </div>
      </div>
      <div class="field">
        <label>Tags *</label>
        <div class="tag-row">
          <input type="text" [formControl]="tagInput" (keyup.enter)="addTag()" placeholder="Add tag">
          <button type="button" (click)="addTag()" class="btn-add">Add</button>
        </div>
        <div *ngIf="tags.length > 0" class="tags">
          <span *ngFor="let tag of tags" class="tag">
            #{{ tag }}
            <button type="button" (click)="removeTag(tag)">√ó</button>
          </span>
        </div>
        <div *ngIf="tags.length === 0 && videoForm.touched" style="color: #ff4444; font-size: 12px; margin-top: 4px;">
          You must add at least one tag
        </div>
      </div>
      <div class="field">
        <label>Thumbnail *</label>
        <input type="file" #thumbInput accept="image/*" (change)="onThumbnailSelected($event)" hidden>
        <div *ngIf="!thumbnailPreview" (click)="thumbInput.click()" class="upload">
          üñºÔ∏è Click to select an image
        </div>
        <div *ngIf="thumbnailPreview" class="preview">
          <img [src]="thumbnailPreview">
          <button type="button" (click)="thumbInput.click()" class="btn-change">Change</button>
        </div>
      </div>
      <div class="field">
        <label>Video (MP4, max 200MB) *</label>
        <input type="file" #vidInput accept="video/mp4" (change)="onVideoSelected($event)" hidden>
        <div *ngIf="!videoFile" (click)="vidInput.click()" class="upload">
          üé¨ Click to select a video
        </div>
        <div *ngIf="videoFile" class="file-box">
          <span>{{ videoFile.name }} ({{ getVideoSize() }})</span>
          <button type="button" (click)="vidInput.click()" class="btn-change">Change</button>
        </div>
      </div>
      
      <!-- NOVO LOCATION POLJE -->
      <div class="field">
        <label>Location</label>
        
        <!-- Loading indicator -->
        <div class="location-status" *ngIf="isLoadingLocation">
          <span class="spinner">‚è≥</span> Loading your location...
        </div>
        
        <!-- Success indicator with coordinates -->
        <div class="location-status success" *ngIf="latitude && longitude && !isLoadingLocation">
          <span class="success-icon">‚úÖ</span> 
          Location: {{ locationName }} ({{ latitude.toFixed(4) }}, {{ longitude.toFixed(4) }})
        </div>
        
        <!-- Input with GPS button -->
        <div class="location-input-wrapper">
          <input 
            type="text" 
            formControlName="location" 
            placeholder="Address or place name"
            [disabled]="isLoadingLocation"
          >
          <button
            type="button"
            class="btn-gps-location"
            (click)="useGPSLocation()"
            [disabled]="isLoadingLocation || isUploading"
            title="Use precise GPS location"
          >
            üìç GPS
          </button>
        </div>
      </div>

      <!-- Schedule Video Option -->
      <div class="field">
        <label style="margin-bottom: 12px; display: block;">Publishing Options</label>
        
        <div class="schedule-option-card" [class.selected]="isScheduled" (click)="openScheduleDialog()">
          <div class="schedule-option-content">
            <div class="schedule-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
              </svg>
            </div>
            <div class="schedule-text">
              <h3>Schedule for later</h3>
              <p>{{ isScheduled && scheduledTimeDisplay ? scheduledTimeDisplay : 'Set a specific time for your video to go live' }}</p>
            </div>
            <div class="schedule-checkbox">
              <input 
                type="checkbox" 
                [(ngModel)]="isScheduled" 
                [ngModelOptions]="{standalone: true}"
                (click)="$event.stopPropagation()"
                [disabled]="isUploading"
              >
            </div>
          </div>
        </div>
        
        <div *ngIf="isScheduled && !videoForm.get('scheduledTime')?.value" class="validation-error">
          Please select a scheduled time
        </div>
      </div>

      <!-- Schedule Dialog -->
      <div class="dialog-overlay" *ngIf="showScheduleDialog" (click)="closeScheduleDialog()">
        <div class="dialog-content" (click)="$event.stopPropagation()">
          <div class="dialog-header">
            <h2>Schedule Video</h2>
            <button type="button" class="dialog-close" (click)="closeScheduleDialog()">
              <svg width="24" height="24" viewBox="0 0 24 24">
                <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
          
          <div class="dialog-body">
            <p class="dialog-info">
              Your video will be available at the scheduled time.
            </p>
            
            <div class="datetime-input-group">
              <label for="scheduledTime">Choose Date & Time:</label>
              <input 
                type="datetime-local" 
                id="scheduledTime"
                formControlName="scheduledTime"
                [min]="minDateTime"
                (change)="updateScheduledTimeDisplay()"
                [disabled]="isUploading"
              >
            </div>
          </div>
          
          <div class="dialog-footer">
            <button type="button" class="btn-dialog-cancel" (click)="closeScheduleDialog()">
              Cancel
            </button>
            <button type="button" class="btn-dialog-confirm" (click)="confirmSchedule()" [disabled]="!videoForm.get('scheduledTime')?.value">
              Confirm Schedule
            </button>
          </div>
        </div>
      </div>
   
      <div class="buttons">
        <button type="button" (click)="onCancel()" [disabled]="isUploading" class="btn-cancel">
          Cancel
        </button>
        <button type="submit" [disabled]="isUploading" class="btn-submit">
          {{ isUploading ? '‚è≥ Uploading...' : (isScheduled ? 'üìÖ Schedule Video' : 'Publish Video') }}
        </button>
      </div>
    </form>
  </div>
</div>