<div class="page">
  
  <div class="top-actions">
    <button class="back-btn" (click)="onCancel()">
      <svg width="20" height="20" viewBox="0 0 24 24">
        <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      Back
    </button>
  </div>
  
  <div class="container">
    
    <div class="header">
      <h1>Upload Video</h1>
    </div>
    <div *ngIf="errorMessage" class="error-box">{{ errorMessage }}</div>
    <form [formGroup]="videoForm" (ngSubmit)="onSubmit()">
      
      <div class="field">
        <label>Title *</label>
        <input type="text" formControlName="title" placeholder="Enter video title">
        <div *ngIf="videoForm.get('title')?.touched && videoForm.get('title')?.invalid" style="color: #ff4444; font-size: 12px; margin-top: 4px;">
          Title is required (minimum 3 characters)
        </div>
      </div>
      <div class="field">
        <label>Description *</label>
        <textarea formControlName="description" rows="4" placeholder="Enter video description"></textarea>
        <div *ngIf="videoForm.get('description')?.touched && videoForm.get('description')?.invalid" style="color: #ff4444; font-size: 12px; margin-top: 4px;">
          Description is required (minimum 10 characters)
        </div>
      </div>
      <div class="field">
        <label>Tags *</label>
        <div class="tag-row">
          <input type="text" [formControl]="tagInput" (keyup.enter)="addTag()" placeholder="Add tag">
          <button type="button" (click)="addTag()" class="btn-add">Add</button>
        </div>
        <div *ngIf="tags.length > 0" class="tags">
          <span *ngFor="let tag of tags" class="tag">
            #{{ tag }}
            <button type="button" (click)="removeTag(tag)">√ó</button>
          </span>
        </div>
        <div *ngIf="tags.length === 0 && videoForm.touched" style="color: #ff4444; font-size: 12px; margin-top: 4px;">
          You must add at least one tag
        </div>
      </div>
      <div class="field">
        <label>Thumbnail *</label>
        <input type="file" #thumbInput accept="image/*" (change)="onThumbnailSelected($event)" hidden>
        <div *ngIf="!thumbnailPreview" (click)="thumbInput.click()" class="upload">
          üñºÔ∏è Click to select an image
        </div>
        <div *ngIf="thumbnailPreview" class="preview">
          <img [src]="thumbnailPreview">
          <button type="button" (click)="thumbInput.click()" class="btn-change">Change</button>
        </div>
      </div>
      <div class="field">
        <label>Video (MP4, max 200MB) *</label>
        <input type="file" #vidInput accept="video/mp4" (change)="onVideoSelected($event)" hidden>
        <div *ngIf="!videoFile" (click)="vidInput.click()" class="upload">
          üé¨ Click to select a video
        </div>
        <div *ngIf="videoFile" class="file-box">
          <span>{{ videoFile.name }} ({{ getVideoSize() }})</span>
          <button type="button" (click)="vidInput.click()" class="btn-change">Change</button>
        </div>
      </div>
      
      <!-- NOVO LOCATION POLJE -->
      <div class="field">
        <label>Location</label>
        
        <!-- Loading indicator -->
        <div class="location-status" *ngIf="isLoadingLocation">
          <span class="spinner">‚è≥</span> Loading your location...
        </div>
        
        <!-- Success indicator with coordinates -->
        <div class="location-status success" *ngIf="latitude && longitude && !isLoadingLocation">
          <span class="success-icon">‚úÖ</span> 
          Location: {{ locationName }} ({{ latitude.toFixed(4) }}, {{ longitude.toFixed(4) }})
        </div>
        
        <!-- Input with GPS button -->
        <div class="location-input-wrapper">
          <input 
            type="text" 
            formControlName="location" 
            placeholder="Address or place name"
            [disabled]="isLoadingLocation"
          >
          <button
            type="button"
            class="btn-gps-location"
            (click)="useGPSLocation()"
            [disabled]="isLoadingLocation || isUploading"
            title="Use precise GPS location"
          >
            üìç GPS
          </button>
        </div>
      </div>
   
      <div class="buttons">
        <button type="button" (click)="onCancel()" [disabled]="isUploading" class="btn-cancel">
          Cancel
        </button>
        <button type="submit" [disabled]="isUploading" class="btn-submit">
          {{ isUploading ? '‚è≥ Uploading...' : 'Publish Video' }}
        </button>
      </div>
    </form>
  </div>
</div>